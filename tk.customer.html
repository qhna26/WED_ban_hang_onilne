<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TTN SPORT - KhÃ¡ch hÃ ng</title>
  <link rel="stylesheet" href="css/style_nv,kh.css">
  <link rel="stylesheet" href="css/products.css">
  <link rel="stylesheet" href="css/cart.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
  <canvas id="bgCanvas"></canvas> <!-- Canvas luÃ´n hiá»ƒn thá»‹ -->
  <div class="page-container">
    <nav>
      <!-- Nav luÃ´n hiá»ƒn thá»‹ -->
      <ul>
        <li><a href="#" id="homeLink">Trang chá»§</a></li>
        <li><a href="#" id="productsLink">Sáº£n pháº©m</a></li>
        <li><a href="#" id="cartLink">Giá» hÃ ng</a></li>
        <li id="logoutItem" style="display:none;"><button onclick="logout()">ÄÄƒng xuáº¥t</button></li>
        <li class="role-menu">
          <button id="userInfoBtn" title="Vai trÃ² ngÆ°á»i dÃ¹ng">
            <span aria-hidden="true">&#128100;</span>
            <span class="role-text" id="userRoleInNav">KhÃ¡ch (chÆ°a Ä‘Äƒng nháº­p)</span>
          </button>
        </li>
      </ul>
    </nav>

    <main id="content-area" class="page-content"></main>
  </div>

  <footer class="footer">
    <!-- Footer luÃ´n hiá»ƒn thá»‹, khÃ´ng máº¥t -->
    <div class="footer-content">
      <div class="footer-logo">
        <img src="./images/Thiáº¿t káº¿ chÆ°a cÃ³ tÃªn.png" alt="Logo TTN">
        <h2>TTN SPORTâ„¢</h2>
      </div>
      <div class="footer-links">
        <a href="#">Developers & Companies</a>
        <a href="#">Creators</a>
        <a href="#">About Us</a>
        <a href="#">Contact</a>
      </div>
      <div class="footer-socials">
        <a href="#"><i class="fa-brands fa-linkedin-in"></i></a>
        <a href="#"><i class="fa-brands fa-instagram"></i></a>
        <a href="#"><i class="fa-brands fa-discord"></i></a>
      </div>
    </div>
    <div class="footer-bottom">
      <p>Â© TTN SPORT</p>
      <div>
        <a href="#">Privacy Policy</a>
        <a href="#">Terms of Service</a>
      </div>
    </div>
  </footer>

  <script src="js/checkRole.js"></script>
  <script src="js/auth.js"></script> 
  <script src="js/slider.js"></script>
  <script src="js/scroll-animate.js"></script>
  <script src="js/product.js"></script>
  
  <script>
    const contentArea = document.getElementById("content-area");

    function loadPage(page) {
      contentArea.classList.remove('transition-in');
      contentArea.classList.add('transition-out');
      
      setTimeout(() => {
        cleanupSlider();
        cleanupScrollAnimation();

        fetch(`pages/${page}`)
          .then(res => res.text())
          .then(html => {
            contentArea.innerHTML = html;
            if (page === "products.html") {
      initProductFilter(); // <-- Gá»i hÃ m khi load products
    }
            initSlider();
            initScrollAnimation();

            setTimeout(() => {
              contentArea.classList.remove('transition-out');
              contentArea.classList.add('transition-in');
            }, 50);
          })
          .catch(err => {
            console.error("Lá»—i táº£i trang:", err);
            contentArea.classList.remove('transition-out');
            contentArea.classList.add('transition-in');
          });
      }, 600);
    }

    document.addEventListener("DOMContentLoaded", () => {
      contentArea.classList.add('transition-in');
      
      if (!sessionStorage.getItem("username")) {
        loadPage("home.html");
      } else {
        loadPage("home.html");
        document.getElementById("userRoleInNav").textContent = sessionStorage.getItem("username");
        document.getElementById("logoutItem").style.display = "inline-block";
      }
      
      document.getElementById("homeLink").addEventListener("click", (e) => {
        e.preventDefault();
        loadPage("home.html");
      });
      document.getElementById("productsLink").addEventListener("click", (e) => {
        e.preventDefault();
        loadPage("products.html");
      });
      document.getElementById("cartLink").addEventListener("click", (e) => {
        e.preventDefault();
        loadPage("cart.html");
      });

      // Sá»­a nÃºt userInfoBtn Ä‘á»ƒ redirect tá»›i login.html
      const userInfoBtn = document.getElementById("userInfoBtn");
      if (userInfoBtn) {
        userInfoBtn.addEventListener("click", () => {
          if (!sessionStorage.getItem("username")) {
            window.location.href = "pages/login.html"; // Äiá»u chá»‰nh Ä‘Æ°á»ng dáº«n
          } else {
            alert(`ÄÃ£ Ä‘Äƒng nháº­p vá»›i tÃªn: ${sessionStorage.getItem("username")}`);
          }
        });
      }
    });

    // HÃ m logout
    // ğŸ§  HÃ m Ä‘Äƒng xuáº¥t chuáº©n
function logout() {
  // XÃ³a toÃ n bá»™ session + local (náº¿u cÃ³ dÃ¹ng)
  sessionStorage.clear();
  localStorage.removeItem("currentUser");

  // âœ… Chuyá»ƒn hÆ°á»›ng háº³n vá» trang Ä‘Äƒng nháº­p (trong folder pages)
  window.location.href = "pages/login.html";
}

  </script>
</body>
</html>